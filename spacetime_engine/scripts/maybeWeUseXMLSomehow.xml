<primitive name="Print" binding="print">
    <inputs>
        <input name="message" type="string"/>
    </inputs>

    <outputs>
    </outputs>
</primitive>

<primitive name="CreateEntity" binding="entity.create">
    <inputs>
    </inputs>

    <outputs>
        <output name="entity_id" type="int"/>
    </outputs>
</primitive>

<primitive name="UpgradeToChunk" binding="chunk.upgrade">
    <inputs>
        <input name="entity_id" type="int"/>
        <input name="chunk_id" type="int"/>
    </inputs>

    <outputs>
    </outputs>
</primitive>

<primitive name="IsChunk" binding="entity.isChunk">
    <inputs>
        <input name="entity_id" type="int"/>
        <input name="chunk_id" type="int"/>
    </inputs>

    <outputs>
        <output name="is_chunk" type="bool"/>
    </outputs>
</primitive>

<composite name="SpawnChunk">
    <inputs>
        <input name="chunk_id" type="int"/>
    </inputs>

    <outputs>
        <output name="entity_id" type="int"/>
        <output name="is_valid" type="bool"/>
    </outputs>

    <constants>
        <constant name="vel_x" type="int" value="10"/>
        <constant name="vel_y" type="int" value="20"/>
        <constant name="success_message" type="string" value="Chunk spawned successfully."/>
        <constant name="error_message" type="string" value="Chunk spawn failed!"/>
    </constants>

    <variables>
        <variable name="is_active" type="bool"/>
    </variables>

    <sequence>
        <op name="create_entity" type="CreateEntity">
            <assign_output name="entity_id" to="entity_id"/>
        </op>

        <op name="upgrade_chunk" type="UpgradeToChunk">
            <assign_input name="entity_id" from="entity_id"/>
            <assign_input name="chunk_id" from="chunk_id"/>
        </op>

        <op name="validate_entity" type="IsChunk">
            <assign_input name="entity_id" from="entity_id"/>
            <assign_output name="is_chunk" to="is_active"/>
        </op>

        <if condition="is_active">
            <op name="print_success" type="Print">
                <assign_input name="message" from="success_message"/>
            </op>
        </if>
        <else>
            <op name="print_error" type="Print">
                <assign_input name="message" from="error_message"/>
            </op>
        </else>
    </sequence>
</composite>

<composite name="SpawnChunks">
    <inputs>
        <input name="chunk_ids" type="int[]"/>
    </inputs>

    <outputs>
        <output name="entity_ids" type="int[]"/>
        <output name="are_valid" type="bool"/>
    </outputs>

    <sequence>
        <for name="spawn_chunk_loop" iterator="chunk_id" in="chunk_ids">
            <op name="spawn_chunk" type="SpawnChunk">
                <assign_input name="chunk_id" from="chunk_id"/>
                <assign_output name="entity_id" to="entity_id"/>
                <assign_output name="is_valid" to="are_valid"/>
            </op>

            <assign_output name="entity_id" to="entity_ids"/>
        </for>
    </sequence>
</composite>